### 安装运行swoole

* 1.进行网络通信：如创建http服务器，创建websocket服务器

* 2.进程管理

* 3.异步操作文件

* 4.毫秒级定时器（linux 有 crontab 但是只能是秒）

**下载swoole**

```
wget https://github.com/swoole/swoole-src/archive/v1.9.1-stable.tar.gz
```

```
tar -zxvf v1.9.1-stable.tar.gz
```

**通过PHP的phpize文件生成swoole的配置文件**
```
[root@localhost swoole]# /usr/local/bin/php7/bin/phpize
```

**安装autoconf**

```
yum -y install m4 autoconf
```

**配置**
```
./configure --with-php-config=/usr/local/bin/php7/bin/php-config
```

**安装gcc-c++**
```
yum -y install glibc-headers gcc-c++
```

**编译安装**
```
make && make install
```

**修改PHP配置文件，开启swoole扩展**
```
vim /usr/local/bin/php7/lib/php.ini
```
```
909 extension=swoole
```

**查看扩展是否开启成功**
```
php -m
```

### 创建http服务器
```
<?php
#1.创建对象
$httpServer=new swoole_http_server('0.0.0.0',8001);

#2.监听端口请求：无-则不操作，有-则交给回调函数
$httpServer->on('request',function($request,$response){
         //var_dump($request);
         //echo "<hr>";
         //var_dump($response);
	 //响应内容
         $response->end('hellp');

 });
#3.启动服务器
$httpServer->start();
```

### 创建WebSocket服务器

* 服务端

```
<?php
###注意：fd指客户端唯一标识（每建立一个连接都有一个唯一标识，后期就通过该标识通信）

#1.创建websocket服务
$server = new swoole_websocket_server("0.0.0.0", 8003);
#2.握手成功，触发回调函数
$server->on('open', function (swoole_websocket_server $server, $request) {
    echo "server: handshake success with fd{$request->fd}\n";
});
#3.收到消息，触发回调函数
$server->on('message', function (swoole_websocket_server $server, $frame) {
    echo "receive from {$frame->fd}:{$frame->data},opcode:{$frame->opcode},fin:{$frame->finish}\n";
    $server->push($frame->fd, "this is server");
});
#3.关闭连接，触发回调函数
$server->on('close', function ($ser, $fd) {
    echo "client {$fd} closed\n";
});
#4.启动websocket服务
$server->start();
```

* 客户端

```
<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
</head>
<body>
	<textarea id="textarea"></textarea>
	<br />
	<input type="button" value="发送数据" onclick="send()" />
	<script type="text/javascript">
		//创建websocket对象
		var ws = new WebSocket("ws://192.168.184.128:8003");
		
		//握手成功出发
	  	ws.onopen = function() {
          console.log("连接成功");
           };

		//收到socket服务消息，则触发回调函数
		ws.onmessage = function(event) {
		  var data = event.data;
		  console.log("收到socket服务消息，内容：" + data);
		};

		function send() {
			var data = document.getElementById('textarea').value;
			ws.send(data);
		}
	</script>
</body>
</html>
```

### 定时器

* 1、延迟执行（ 同setTimeout ）

```
swoole_timer_after(3000,function(){
        echo 123,"\r\n";
});
echo 456,"\r\n";
```

* 2、毫秒级定时器（ 同setInterval ）

```
swoole_timer_tick(3000,function(){
        echo 123,"\r\n";
});
```

### 异步的读取

```
<?php
echo 123,"\r\n";
swoole_async_readfile('./test.txt',function($filename,$contents){
        echo $contents,"\r\n";
});
echo 456,"\r\n";
```
```
123
456
文件中的内容
```
